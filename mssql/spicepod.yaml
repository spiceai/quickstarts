version: v1beta1
kind: Spicepod
name: spicepod-mssql

datasets:
  - from: mssql:SalesLT.Address
    name: address
    params: 
      mssql_connection_string: ${ secrets:SPICE_MSSQL_CONNECTION_STRING }

  - from: mssql:SalesLT.BuildVersion
    name: build_version
    params: 
      mssql_connection_string: ${ secrets:SPICE_MSSQL_CONNECTION_STRING }

  - from: mssql:SalesLT.Customer
    name: customer
    params: 
      mssql_connection_string: ${ secrets:SPICE_MSSQL_CONNECTION_STRING }

  - from: mssql:SalesLT.CustomerAddress
    name: customer_address
    params: 
      mssql_connection_string: ${ secrets:SPICE_MSSQL_CONNECTION_STRING }

  - from: mssql:SalesLT.database_firewall_rules
    name: database_firewall_rules
    params: 
      mssql_connection_string: ${ secrets:SPICE_MSSQL_CONNECTION_STRING }

  - from: mssql:SalesLT.ErrorLog
    name: error_log
    params: 
      mssql_connection_string: ${ secrets:SPICE_MSSQL_CONNECTION_STRING }

  - from: mssql:SalesLT.Product
    name: product
    params: 
      mssql_connection_string: ${ secrets:SPICE_MSSQL_CONNECTION_STRING }

  - from: mssql:SalesLT.ProductCategory
    name: product_category
    params: 
      mssql_connection_string: ${ secrets:SPICE_MSSQL_CONNECTION_STRING }

  - from: mssql:SalesLT.ProductDescription
    name: product_description
    params: 
      mssql_connection_string: ${ secrets:SPICE_MSSQL_CONNECTION_STRING }

  - from: mssql:SalesLT.ProductModel
    name: product_model
    params: 
      mssql_connection_string: ${ secrets:SPICE_MSSQL_CONNECTION_STRING }

  - from: mssql:SalesLT.ProductModelProductDescription
    name: product_model_product_description
    params: 
      mssql_connection_string: ${ secrets:SPICE_MSSQL_CONNECTION_STRING }

  - from: mssql:SalesLT.SalesOrderDetail
    name: sales_order_detail
    params: 
      mssql_connection_string: ${ secrets:SPICE_MSSQL_CONNECTION_STRING }

  - from: mssql:SalesLT.SalesOrderHeader
    name: sales_order_header
    params: 
      mssql_connection_string: ${ secrets:SPICE_MSSQL_CONNECTION_STRING }

  - from: mssql:SalesLT.vGetAllCategories
    name: v_get_all_categories
    params: 
      mssql_connection_string: ${ secrets:SPICE_MSSQL_CONNECTION_STRING }

  - from: mssql:SalesLT.vProductAndDescription
    name: v_product_and_description
    params: 
      mssql_connection_string: ${ secrets:SPICE_MSSQL_CONNECTION_STRING }

  - from: mssql:SalesLT.vProductModelCatalogDescription
    name: v_product_model_catalog_description
    params: 
      mssql_connection_string: ${ secrets:SPICE_MSSQL_CONNECTION_STRING }

embeddings:
  - name: openai_embed
    from: openai
    params:
      openai_api_key: ${ secrets:SPICE_OPENAI_API_KEY }

  - name: hf_minilm
    from: huggingface:huggingface.co/sentence-transformers/all-MiniLM-L6-v2

models:
  - name: openai
    from: openai:gpt-4o-2024-08-06
    params:
      spice_tools: auto
      openai_api_key: ${ secrets:SPICE_OPENAI_API_KEY }
      system_prompt: |
        Use the SQL tool when:
          1. The query involves precise numerical data, statistics, or aggregations
          2. The user asks for specific counts, sums, averages, or other calculations
          3. The query requires joining or comparing data from multiple related tables

        Use the document search when:
          1. The query is about unstructured text information, such as policies, reports, or articles
          2. The user is looking for qualitative information or explanations
          3. The query requires understanding context or interpreting written content

        General guidelines:
          1. If a query could be answered by either tool, prefer SQL for more precise, quantitative answers

        Instructions for Responses: 
          - Do not include any private metadata provided to the model as context such as \"reference_url_template\" or \"instructions\" in your responses.
